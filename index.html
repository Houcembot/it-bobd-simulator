<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>It bobd - Simulateur d'Expressions Robot</title>
    <style>
        body { margin: 0; padding: 20px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        h1 { margin: 0 0 10px 0; font-size: 2.5em; text-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .subtitle { color: #888; margin-bottom: 30px; }
        #container { display: flex; gap: 40px; align-items: flex-start; flex-wrap: wrap; justify-content: center; }
        #screen-container { position: relative; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        #led-ring { position: absolute; width: 340px; height: 340px; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 50%; filter: blur(30px); opacity: 0.6; z-index: 0; transition: background 0.5s ease; }
        #canvas { border-radius: 50%; box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.3); position: relative; z-index: 1; }
        #controls { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); max-width: 450px; }
        h2 { margin-top: 0; color: #fff; font-size: 1.5em; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-bottom: 20px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn-full { grid-column: span 2; }
        button { padding: 12px 15px; font-size: 13px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-transform: uppercase; letter-spacing: 1px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        button:active { transform: translateY(0); }
        #btn-dashboard { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: white; }
        #btn-myroboeyes { background: linear-gradient(135deg, #9370DB 0%, #BA55D3 100%); color: white; }
        #btn-cold { background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%); color: white; }
        #btn-overheat { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); color: white; }
        #btn-start { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        #btn-shocked { background: linear-gradient(135deg, #ffd89b 0%, #190a05 100%); color: white; }
        #mood-label { font-size: 1.2em; margin-top: 15px; padding: 10px 20px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>
    <h1>ü§ñ It bobd Simulator</h1>
    <p class="subtitle">MOTEUR & TEMP√âRATURE - Catalogue d'expressions</p>
    <div id="container">
        <div id="screen-container">
            <div id="led-ring"></div>
            <canvas id="canvas" width="240" height="240"></canvas>
            <div id="mood-label">D√âMARRAGE...</div>
        </div>
        <div id="controls">
            <h2>‚öôÔ∏è Moteur & Temp√©rature</h2>
            <div class="btn-group">
                <button id="btn-dashboard" class="btn-full" onclick="setExpression('dashboard')">üìä Dashboard OBD</button>
                <button id="btn-myroboeyes" class="btn-full" onclick="setExpression('myroboeyes')">üëÄ Yeux Uniquement</button>
                <button id="btn-cold" onclick="setExpression('cold')">ü•∂ Moteur Froid</button>
                <button id="btn-overheat" onclick="setExpression('overheat')">ü•µ Surchauffe</button>
                <button id="btn-start" onclick="setExpression('start')">üòä D√©marrage OK</button>
                <button id="btn-shocked" onclick="setExpression('shocked')">üò± Moteur Cale</button>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
        const ledRing = document.getElementById('led-ring'); const moodLabel = document.getElementById('mood-label');
        let currentExpression = 'dashboard'; let animFrame = 0; let switchTimer = 0; let isSwitching = true;
        const COLORS = { BLACK: '#000000', WHITE: '#FFFFFF', CREAM: '#FFF8DC', YELLOW: '#FFD700', CYAN: '#00FFFF', MAGENTA: '#FF00FF', BLUE: '#0000FF', GREEN: '#00FF00', ORANGE: '#FFA500', RED: '#FF0000', BG_DARK_BLUE: '#000005', V_DARK: '#010110' };
        const LED_COLORS = { cold: 'radial-gradient(circle, rgba(0,210,255,0.8) 0%, rgba(58,123,213,0.4) 100%)', overheat: 'radial-gradient(circle, rgba(255,65,108,0.8) 0%, rgba(255,75,43,0.4) 100%)', start: 'radial-gradient(circle, rgba(86,171,47,0.8) 0%, rgba(168,224,99,0.4) 100%)', shocked: 'radial-gradient(circle, rgba(255,216,155,0.8) 0%, rgba(25,10,5,0.4) 100%)', dashboard: 'radial-gradient(circle, rgba(48,207,208,0.8) 0%, rgba(51,8,103,0.4) 100%)', myroboeyes: 'radial-gradient(circle, rgba(147,112,219,0.8) 0%, rgba(186,85,211,0.4) 100%)' };
        let my_eyeW=56, my_eyeH_Max=56, my_curLx=42, my_curLy=92, my_curLh=56, my_targetLx=42, my_targetLy=92, my_targetLh=56, my_currentMood = 0;
        let my_blinkTimer = performance.now()+2000, my_idleTimer = performance.now()+4000, my_moodTimer = performance.now()+4000;

        function updateEyesLogic() {
            const now = performance.now();
            let blinkSpeed = 0.20; // Vitesse par d√©faut
            let moveSpeed = 0.20; // Vitesse par d√©faut
            
            if (currentExpression === 'start') {
                let cycle = (now - switchTimer) % 3000; 
                if (cycle < 1000) my_targetLx = 25; 
                else if (cycle < 2000) my_targetLx = 65; 
                else my_targetLx = 42;
                my_targetLy = 92; my_targetLh = 56;
                moveSpeed = 0.15; // Balayage plus "humain"
            } else if (currentExpression === 'shocked') {
                let stage = (now - switchTimer) % 2500; // Cycle court pour le bug
                if (stage < 300) { my_targetLh = 56; }
                else if (stage < 500) { my_targetLh = 0; }
                else if (stage < 1500) { my_targetLh = 4; } // Plat (-_-)
                else if (stage < 1700) { my_targetLh = 0; }
                else { my_targetLh = 56; }
                my_targetLx = 42; my_targetLy = 92;
                blinkSpeed = 0.85; // TR√àS RAPIDE pour le bug
            } else {
                if (now > my_moodTimer && (currentExpression==='dashboard'||currentExpression==='myroboeyes')) { my_currentMood = (my_currentMood+1)%4; my_moodTimer = now+4000; }
                if (now > my_blinkTimer) { my_targetLh = 0; my_blinkTimer = now+Math.random()*3000+2000; }
                if (now > my_idleTimer) { my_targetLx = Math.random()*50+40; my_targetLy = Math.random()*35+70; my_idleTimer = now+Math.random()*4000+2000; }
                blinkSpeed = (my_targetLh === 0 || my_curLh < 10) ? 0.45 : 0.25;
            }
            
            my_curLx += (my_targetLx - my_curLx) * moveSpeed;
            my_curLy += (my_targetLy - my_curLy) * moveSpeed;
            my_curLh += (my_targetLh - my_curLh) * blinkSpeed;
            
            if (my_curLh < 1.0 && currentExpression !== 'shocked') my_targetLh = 56;
        }

        function drawBaseEyes(bgColor, mode = 'normal') {
            ctx.fillStyle = bgColor; ctx.fillRect(0, 0, 240, 240);
            let drawW=56, drawH=Math.floor(my_curLh), drawRadius=16, finalY, xL, xR;
            let currentMoodToDraw = (mode === 'start' || mode === 'shocked') ? 0 : my_currentMood;
            if (mode === 'overheat') currentMoodToDraw = 2;

            if (my_curLh < 12) { 
                drawW=64; drawH=Math.max(2, Math.floor(my_curLh/2)); 
                drawRadius=3; 
                finalY=Math.floor(my_curLy+25); 
                xL=Math.floor(my_curLx-4); xR=xL+88; 
            } else { 
                finalY=Math.floor(my_curLy+(56-drawH)/2); 
                xL=Math.floor(my_curLx); xR=xL+80; 
            }
            
            ctx.fillStyle = COLORS.WHITE;
            roundRect(ctx, xL, finalY, drawW, drawH, drawRadius, true);
            roundRect(ctx, xR, finalY, drawW, drawH, drawRadius, true);
            
            if (my_curLh >= 12) {
                let mH = drawH/2;
                if (currentMoodToDraw===2) { fillTriangle(ctx,xL,finalY,xL+drawW,finalY,xL+drawW,finalY+mH,bgColor); fillTriangle(ctx,xR,finalY,xR+drawW,finalY,xR,finalY+mH,bgColor); }
                else if (currentMoodToDraw===1) { fillTriangle(ctx,xL,finalY,xL+drawW,finalY,xL,finalY+mH,bgColor); fillTriangle(ctx,xR,finalY,xR+drawW,finalY,xR+drawW,finalY+mH,bgColor); }
                else if (currentMoodToDraw===3) { ctx.fillStyle = bgColor; roundRect(ctx,xL-2,finalY+mH,drawW+4,60,16,true); roundRect(ctx,xR-2,finalY+mH,drawW+4,60,16,true); }
            }
        }

        function drawOverheat() { drawBaseEyes('#290000', 'overheat'); ctx.fillStyle = COLORS.CYAN; for(let i=0; i<3; i++) { let dropY = 100 + (animFrame*2 + i*40)%100; ctx.beginPath(); ctx.arc(210, dropY, 4, 0, Math.PI*2); ctx.fill(); } }
        function drawCold() { let shiverX = (Math.random()-0.5)*3; let shiverY = (Math.random()-0.5)*3; drawBaseEyes('#001529', 'cold'); let mouthW = 80, mouthH = 30; let mx = 120-mouthW/2+shiverX; let my = 170+shiverY; ctx.fillStyle = COLORS.WHITE; roundRect(ctx, mx, my, mouthW, mouthH, 5, true); ctx.strokeStyle = '#CCCCCC'; ctx.lineWidth = 2; for(let i=1; i<6; i++) { ctx.beginPath(); ctx.moveTo(mx+(mouthW/6)*i, my); ctx.lineTo(mx+(mouthW/6)*i, my+mouthH); ctx.stroke(); } ctx.beginPath(); ctx.moveTo(mx, my+mouthH/2); ctx.lineTo(mx+mouthW, my+mouthH/2); ctx.stroke(); }
        function drawDashboard() { drawBaseEyes(COLORS.BG_DARK_BLUE); const spd = Math.floor(80 + Math.sin(animFrame * 0.05) * 40); const rpm = Math.floor(3000 + Math.sin(animFrame * 0.03) * 2000); drawArc(120, 120, 115, 100, 60, 60 + 240, COLORS.V_DARK); drawArc(120, 120, 95, 85, 60, 60 + 240, COLORS.V_DARK); drawArc(120, 120, 115, 100, 60, 60 + (spd/240*240), (spd<40?COLORS.BLUE:spd<80?COLORS.YELLOW:COLORS.GREEN)); drawArc(120, 120, 95, 85, 60, 60 + (rpm/8000*240), (rpm<2000?COLORS.YELLOW:rpm<4000?COLORS.ORANGE:COLORS.RED)); ctx.textAlign = 'center'; ctx.fillStyle = COLORS.CYAN; ctx.font = '30px Arial'; ctx.fillText('90', 120, 80); ctx.fillStyle = COLORS.WHITE; ctx.font = '50px Arial'; ctx.fillText(rpm, 120, 135); ctx.fillStyle = COLORS.YELLOW; ctx.font = '40px Arial'; ctx.fillText(spd, 120, 195); }
        function drawArc(x, y, r, innerR, startAngle, endAngle, color) { ctx.beginPath(); let sa = (startAngle+90)*Math.PI/180; let ea = (endAngle+90)*Math.PI/180; ctx.arc(x, y, r, sa, ea); ctx.arc(x, y, innerR, ea, sa, true); ctx.fillStyle = color; ctx.fill(); }
        function setExpression(expr) { currentExpression = expr; animFrame = 0; ledRing.style.background = LED_COLORS[expr]; switchTimer = performance.now(); if (expr === 'dashboard') { isSwitching = true; moodLabel.textContent = "INITIALISATION..."; } else { isSwitching = false; moodLabel.textContent = expr.toUpperCase(); } }
        function roundRect(ctx, x, y, width, height, radius, fill) { ctx.beginPath(); ctx.moveTo(x+radius, y); ctx.lineTo(x+width-radius, y); ctx.quadraticCurveTo(x+width, y, x+width, y+radius); ctx.lineTo(x+width, y+height-radius); ctx.quadraticCurveTo(x+width, y+height, x+width-radius, y+height); ctx.lineTo(x+radius, y+height); ctx.quadraticCurveTo(x, y+height, x, y+height-radius); ctx.lineTo(x, y+radius); ctx.quadraticCurveTo(x, y, x+radius, y); ctx.closePath(); if (fill) ctx.fill(); else ctx.stroke(); }
        function fillTriangle(ctx,x1,y1,x2,y2,x3,y3,color) { ctx.fillStyle=color; ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.lineTo(x3,y3); ctx.closePath(); ctx.fill(); }

        function animate() {
            animFrame++; updateEyesLogic();
            if (currentExpression === 'dashboard') { if (isSwitching) { drawBaseEyes(COLORS.BLACK); if (performance.now()-switchTimer > 5000) { isSwitching = false; moodLabel.textContent = "DASHBOARD OBD"; } } else { drawDashboard(); } }
            else if (currentExpression === 'myroboeyes') { drawBaseEyes(COLORS.BLACK); }
            else if (currentExpression === 'cold') { drawCold(); }
            else if (currentExpression === 'overheat') { drawOverheat(); }
            else if (currentExpression === 'start') { drawBaseEyes('#1a2e1a', 'start'); }
            else if (currentExpression === 'shocked') { drawBaseEyes('#2e1a05', 'shocked'); }
            requestAnimationFrame(animate);
        }
        setExpression('dashboard'); animate();
    </script>
</body>
</html>
